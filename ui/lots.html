<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>INRIX Lots</title>
    <link
      href="http://fonts.googleapis.com/css?family=Lato:400,700"
      rel="stylesheet"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" type="text/css" href="shared-styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script type="text/javascript" src="client-config.js"></script>
    <script src="https://cdn.rawgit.com/vkiryukhin/vkBeautify/master/vkbeautify.js"></script>
    <script type="text/javascript" src="token.js"></script>
  </head>

  <body>
    <h2 class="title">Parking lots with OSM</h2>
    <div class="description">
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin eget
      ullamcorper metus, sit amet aliquam dolor. Fusce ac fringilla nibh. In
      pellentesque non turpis quis blandit. Ut venenatis ipsum id dolor
      tincidunt varius. Nam quis molestie tellus, ut ultricies libero. Aliquam
      dignissim, sapien a elementum volutpat, justo nisi malesuada justo, a
      pellentesque nibh mauris in nibh. Sed vel leo augue. Nullam sit amet neque
      a mauris vulputate gravida. Nam eu turpis quis risus tristique vulputate
      sed eu tortor. Vestibulum convallis euismod arcu, eu scelerisque mauris
      luctus in. Donec non massa mauris. Aliquam finibus tristique enim eu
      ultrices. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices
      posuere cubilia curae; Mauris commodo risus tellus, in pellentesque purus
      suscipit ac. Suspendisse sit amet felis finibus, tincidunt ante ac,
      euismod tortor. Sed at condimentum augue, ac lacinia dui. Etiam viverra
      massa et orci lobortis, varius laoreet leo viverra. Aliquam vulputate,
      ligula vitae molestie semper, turpis erat blandit velit, in consectetur ex
      libero quis augue. Mauris iaculis sed massa vel accumsan. Phasellus
      commodo felis dictum mauris mollis facilisis et et erat. Etiam a erat
      erat.
    </div>
    <div class="row">
      <!-- Structure of the options panel on the left -->
      <div class="options-panel">
        <div class="options">
          <h4>Radius (km)</h4>
          <ul class="items">
            <li><input type="checkbox" name="radius" value="10" />10</li>
            <li><input type="checkbox" name="radius" value="15" />15</li>
            <li>
              <input type="checkbox" name="radius" value="150" checked />150
            </li>
          </ul>
        </div>
        <div class="options center">
          <input
            type="button"
            onclick="drawLots()"
            value="Show"
            class="btn"
          /><br />
        </div>
        <div id="loading-panel" class="center" style="display: none">
          <h2>Getting results...</h2>
        </div>
      </div>

      <div class="map-panel">
        <div id="map"></div>
      </div>
    </div>
  </body>

  <script>
    //Global variables

    // Setting up bounds that will be used to calucalte the center of the area
    // In our case it should be San Francisco
    // const southWest = L.latLng(37.718455, -122.350874),
    //     northEast = L.latLng(37.810963, -122.535406);

    const southWest = L.latLng(39.0846, -85.4973),
      northEast = L.latLng(40.5398, -82.7204);
    const bounds = L.latLngBounds(southWest, northEast);

    // Init Leaflet Maps with the location (hardcoded below to San Francisco) and appropriate zoom level
    const map = new L.Map("map", {
      zoom: 12,
      center: bounds.getCenter(),
    });

    // Create OSM Tile Layer and providing some max and min zoom level
    const osm = new L.TileLayer(config.openStreetMapAPI, {
      minZoom: 5,
      maxZoom: 18,
    });

    // Adding the Open Street Map layer
    map.addLayer(osm);

    // Perequisites: start the backend with: node express_backend/index.js
    // Helper function to fetch token from an API backend

    // Helper function used to extract values from checked checkboxes.
    // Used to retrieve the options values from the panel on the left.
    async function readCheckboxValues(checkedCheckboxArray) {
      var result = "";
      for (var i = 0, n = checkedCheckboxArray.length; i < n; i++) {
        result += "," + checkedCheckboxArray[i].value;
      }

      if (result) {
        result = result.substring(1);
      }

      return result;
    }

    // Function that should make a call based on the passed options to INRIX Drive Time Polygons API,
    // get the xml data, transform it to JSON array with coordinates
    async function getLotsData() {
      // // Getting the range type so we could append its value as query parameter
      // const rangeType = document.querySelector(
      //   'input[name="rangeType"]:checked'
      // ).value;
      // Gettig the duration so we could append its value as query parameter
      const radius = await readCheckboxValues(
        document.querySelectorAll('input[name="radius"]:checked')
      );
      // // Getting the Avoid options so we could add it as query parameter
      // const avoid = await readCheckboxValues(
      //   document.querySelectorAll('input[name="avoid"]:checked')
      // );
      // // Getting the arrival options so we could append it as query parameter
      // const arrivalInput = document.getElementById("arrival").value;

      // let arrivalDateTime = new Date();

      // // Preparing the arrival Date - formatting it properly so the endpoint could understand it
      // if (arrivalInput) {
      //   arrivalDateTime.setHours(arrivalInput.split(":")[0]);
      //   arrivalDateTime.setMinutes(arrivalInput.split(":")[1]);
      // }
      // var arrivalDateTimeUTC = arrivalDateTime.toJSON();

      // this.center ="37.74638779388551%7C-122.42209196090698";

      // Constructing the URL to INRIX Drive Time Polygons
      // const driveTimePolygonsURL =
      //   config.lotsAPI + "?point=" + this.center + "&radius=" + radius;

      //             config.appId = "0vl5hsc1m5";
      // config.hashToken = "MHZsNWhzYzFtNXx6dWJSUFpucU9OYXF6ZmlIaXdtcWI0Wm8zNjB1eVUwOTczcmthcm1Y";

      // Preparing the axios headers. Very impotant to note is the Authorization Header
      // const axiosConfig = {
      //     headers: {
      //         "content-type": "application/json",
      //         Accept: "application/json",
      //         Authorization: "Bearer " + this.accessToken.token,
      //     },
      // };

      // Executing a call using axios to get the Drive Time Polygons data
      // const driveTimePolygonsResponse = await axios
      //     .get(driveTimePolygonsURL, axiosConfig)
      //     .then((response) => {
      //         console.log(response.data);
      //         console.log('hello');

      //         return response.data;
      //     })
      //     .catch((error) => {
      //         console.error(error);
      //     });

      // patching
      return {
        copyright: "Copyright INRIX Inc.",
        versionNumber: "5.2",
        createdDate: "2019-04-10T18:09:34Z",
        result: [
          {
            paymentIDs: [],
            spacesTotal: 97,
            operator: "ABM",
            navigationAddress: {
              street: "123 W 3rd St",
              city: "Dayton",
              state: "OH",
              postal: "45402",
              country: "US",
              type: "NAVIGATION",
            },
            name: "City of Dayton Municipal Parking Garage",
            pois: [],
            rateCard: [
              "1 Hour: $2",
              "Each Add'l 30 Min: $1",
              "Daily Max: $8",
              "Evening (In After 5pm): $3",
              "Sat-Sun: $3",
              "Rates Reset At 4am",
              "Event Rates Supersede Other Rates",
            ],
            type: "Non-restricted",
            peps: [
              {
                pepPt: [-84.1945320021, 39.7592129757],
                pepAz: 1,
                pepPrimary: null,
                pepType: "IN",
              },
            ],
            url: "https://www.parkme.com/lot/92947/city-of-dayton-municipal-parking-garage-dayton-oh",
            hrs: ["Mon-Sun: 12am-11:59pm", "No Overnight Parking"],
            costIndex: 2,
            occupancy: {
              probability: 57,
              pct: 65,
              rank: 1,
              bucket: 2,
              available: null,
            },
            note: "Lost Ticket Pays Max",
            lotCategory: "Public Parking",
            reservations: [],
            id: 92947,
            currencyIso: "USD",
            phone: "(937) 225-4572",
            ev_chargers: [
              {
                site_code: "cdb05f03-42b0-11e3-8ff9-00259079a43a",
                names: [
                  {
                    name: "Test EV Charger",
                    locale: "en-US",
                  },
                ],
                display_point: {
                  coordinates: {
                    latitude: "48.2137165",
                    longitude: "-1.5050396",
                  },
                },
                ports: [
                  {
                    connector_type: "TYPE_3",
                    id: "1",
                    voltage_volt: "400",
                    current_amps: "32",
                    level: "LEVEL 3",
                    power_kw: "22.00",
                  },
                ],
                manufacturer: "Renault",
                network: "Renault",
                reservable: "false",
              },
            ],
            amenities: [
              {
                id: 2,
                name: "Max Height",
                value: 82,
                metric: 2.0828,
              },
              {
                id: 4,
                name: "EV Chargers",
                value: true,
              },
              {
                id: 9,
                name: "Covered Parking Available",
                value: true,
              },
              {
                id: 18,
                name: "Credit Cards Accepted",
                value: true,
              },
            ],
            format: "Structure",
            currency: "$",
            pmtTypes: [
              "Amex",
              "Bills",
              "Coins",
              "Debit card",
              "Discover",
              "MC/Visa",
            ],
            handicapSpacesTotal: 0,
            buildingAddress: {
              street: "123 W 3rd St",
              city: "Dayton",
              state: "OH",
              postal: "45402",
              country: "US",
              type: "LEGAL",
            },
            point: {
              type: "Point",
              coordinates: [-84.1945268525, 39.7595346846],
            },
            polygon: "qntqFxd{`ONxAsB^KmAb@IAKlAU",
            phones: [
              {
                type: "Lot",
                number: "(937) 225-4572",
              },
              {
                type: "Central Office",
                number: "(937) 461-2916",
              },
            ],
            calculatedRates: null,
            isOpen: null,
            tz: "EDT",
          },

          {
            paymentIDs: [],
            spacesTotal: 97,
            operator: "ABM",
            navigationAddress: {
              street: "123 W 3rd St",
              city: "Dayton",
              state: "OH",
              postal: "45402",
              country: "US",
              type: "NAVIGATION",
            },
            name: "City of Dayton Municipal Parking Garage",
            pois: [],
            rateCard: [
              "1 Hour: $2",
              "Each Add'l 30 Min: $1",
              "Daily Max: $8",
              "Evening (In After 5pm): $3",
              "Sat-Sun: $3",
              "Rates Reset At 4am",
              "Event Rates Supersede Other Rates",
            ],
            type: "Non-restricted",
            peps: [
              {
                pepPt: [-84.1945320021, 39.7592129757],
                pepAz: 1,
                pepPrimary: null,
                pepType: "IN",
              },
            ],
            url: "https://www.parkme.com/lot/92947/city-of-dayton-municipal-parking-garage-dayton-oh",
            hrs: ["Mon-Sun: 12am-11:59pm", "No Overnight Parking"],
            costIndex: 2,
            occupancy: {
              probability: 57,
              pct: 65,
              rank: 1,
              bucket: 2,
              available: null,
            },
            note: "Lost Ticket Pays Max",
            lotCategory: "Public Parking",
            reservations: [],
            id: 92947,
            currencyIso: "USD",
            phone: "(937) 225-4572",
            ev_chargers: [
              {
                site_code: "cdb05f03-42b0-11e3-8ff9-00259079a43a",
                names: [
                  {
                    name: "Test EV Charger",
                    locale: "en-US",
                  },
                ],
                display_point: {
                  coordinates: {
                    latitude: "48.2137165",
                    longitude: "-1.5050396",
                  },
                },
                ports: [
                  {
                    connector_type: "TYPE_3",
                    id: "1",
                    voltage_volt: "400",
                    current_amps: "32",
                    level: "LEVEL 3",
                    power_kw: "22.00",
                  },
                ],
                manufacturer: "Renault",
                network: "Renault",
                reservable: "false",
              },
            ],
            amenities: [
              {
                id: 2,
                name: "Max Height",
                value: 82,
                metric: 2.0828,
              },
              {
                id: 4,
                name: "EV Chargers",
                value: true,
              },
              {
                id: 9,
                name: "Covered Parking Available",
                value: true,
              },
              {
                id: 18,
                name: "Credit Cards Accepted",
                value: true,
              },
            ],
            format: "Structure",
            currency: "$",
            pmtTypes: [
              "Amex",
              "Bills",
              "Coins",
              "Debit card",
              "Discover",
              "MC/Visa",
            ],
            handicapSpacesTotal: 0,
            buildingAddress: {
              street: "123 W 3rd St",
              city: "Dayton",
              state: "OH",
              postal: "45402",
              country: "US",
              type: "LEGAL",
            },
            point: {
              type: "Point",
              coordinates: [-84.1945268525, 39.7595346846],
            },
            polygon: "qntqFxd{`ONxAsB^KmAb@IAKlAU",
            phones: [
              {
                type: "Lot",
                number: "(937) 225-4572",
              },
              {
                type: "Central Office",
                number: "(937) 461-2916",
              },
            ],
            calculatedRates: null,
            isOpen: null,
            tz: "EDT",
          },

          {
            paymentIDs: [],
            spacesTotal: 97,
            operator: "ABM",
            navigationAddress: {
              street: "123 W 3rd St",
              city: "Dayton",
              state: "OH",
              postal: "45402",
              country: "US",
              type: "NAVIGATION",
            },
            name: "Townhall Garage",
            pois: [],
            rateCard: [
              "1 Hour: $5",
              "Each Add'l 30 Min: $2",
              "Daily Max: $9",
              "Evening (In After 5pm): $5",
              "Sat-Sun: $1",
              "Rates Reset At 5am",
              "Event Rates Supersede Other Rates",
            ],
            type: "Non-restricted",
            peps: [
              {
                pepPt: [-84.1945320021, 39.7592129757],
                pepAz: 1,
                pepPrimary: null,
                pepType: "IN",
              },
            ],
            url: "https://www.parkme.com/lot/92947/city-of-dayton-municipal-parking-garage-dayton-oh",
            hrs: ["Mon-Sun: 12am-11:59pm", "No Overnight Parking"],
            costIndex: 2,
            occupancy: {
              probability: 57,
              pct: 65,
              rank: 1,
              bucket: 2,
              available: null,
            },
            note: "Lost Ticket Pays Max",
            lotCategory: "Public Parking",
            reservations: [],
            id: 92947,
            currencyIso: "USD",
            phone: "(937) 225-4572",
            ev_chargers: [
              {
                site_code: "cdb05f03-42b0-11e3-8ff9-00259079a43a",
                names: [
                  {
                    name: "Test EV Charger",
                    locale: "en-US",
                  },
                ],
                display_point: {
                  coordinates: {
                    latitude: "48.2137165",
                    longitude: "-1.5050396",
                  },
                },
                ports: [
                  {
                    connector_type: "TYPE_3",
                    id: "1",
                    voltage_volt: "400",
                    current_amps: "32",
                    level: "LEVEL 3",
                    power_kw: "22.00",
                  },
                ],
                manufacturer: "Renault",
                network: "Renault",
                reservable: "false",
              },
            ],
            amenities: [
              {
                id: 2,
                name: "Max Height",
                value: 82,
                metric: 2.0828,
              },
              {
                id: 4,
                name: "EV Chargers",
                value: true,
              },
              {
                id: 9,
                name: "Covered Parking Available",
                value: true,
              },
              {
                id: 18,
                name: "Credit Cards Accepted",
                value: true,
              },
            ],
            format: "Structure",
            currency: "$",
            pmtTypes: [
              "Amex",
              "Bills",
              "Coins",
              "Debit card",
              "Discover",
              "MC/Visa",
            ],
            handicapSpacesTotal: 0,
            buildingAddress: {
              street: "123 W 3rd St",
              city: "Dayton",
              state: "OH",
              postal: "45402",
              country: "US",
              type: "LEGAL",
            },
            point: {
              type: "Point",
              coordinates: [
                -84.186516,

                39.765534,
              ],
            },
            polygon: "qntqFxd{`ONxAsB^KmAb@IAKlAU",
            phones: [
              {
                type: "Lot",
                number: "(937) 225-4572",
              },
              {
                type: "Central Office",
                number: "(937) 461-2916",
              },
            ],
            calculatedRates: null,
            isOpen: null,
            tz: "EDT",
          },

          {
            paymentIDs: [],
            spacesTotal: 97,
            operator: "ABM",
            navigationAddress: {
              street: "123 W 3rd St",
              city: "Dayton",
              state: "OH",
              postal: "45402",
              country: "US",
              type: "NAVIGATION",
            },
            name: "Bestbuy Garage",
            pois: [],
            rateCard: ["1 Hour: $5", "Each Add'l 30 Min: $2", "Daily Max: $9"],
            type: "Non-restricted",
            peps: [
              {
                pepPt: [-84.1945320021, 39.7592129757],
                pepAz: 1,
                pepPrimary: null,
                pepType: "IN",
              },
            ],
            url: "https://www.parkme.com/lot/92947/city-of-dayton-municipal-parking-garage-dayton-oh",
            hrs: ["Mon-Sun: 12am-11:59pm", "No Overnight Parking"],
            costIndex: 2,
            occupancy: {
              probability: 57,
              pct: 65,
              rank: 1,
              bucket: 2,
              available: null,
            },
            note: "Lost Ticket Pays Max",
            lotCategory: "Public Parking",
            reservations: [],
            id: 92947,
            currencyIso: "USD",
            phone: "(937) 225-4572",
            ev_chargers: [
              {
                site_code: "cdb05f03-42b0-11e3-8ff9-00259079a43a",
                names: [
                  {
                    name: "Test EV Charger",
                    locale: "en-US",
                  },
                ],
                display_point: {
                  coordinates: {
                    latitude: "48.2137165",
                    longitude: "-1.5050396",
                  },
                },
                ports: [
                  {
                    connector_type: "TYPE_3",
                    id: "1",
                    voltage_volt: "400",
                    current_amps: "32",
                    level: "LEVEL 3",
                    power_kw: "22.00",
                  },
                ],
                manufacturer: "Renault",
                network: "Renault",
                reservable: "false",
              },
            ],
            amenities: [
              {
                id: 2,
                name: "Max Height",
                value: 82,
                metric: 2.0828,
              },
              {
                id: 4,
                name: "EV Chargers",
                value: true,
              },
              {
                id: 9,
                name: "Covered Parking Available",
                value: true,
              },
              {
                id: 18,
                name: "Credit Cards Accepted",
                value: true,
              },
            ],
            format: "Structure",
            currency: "$",
            pmtTypes: [
              "Amex",
              "Bills",
              "Coins",
              "Debit card",
              "Discover",
              "MC/Visa",
            ],
            handicapSpacesTotal: 0,
            buildingAddress: {
              street: "123 W 3rd St",
              city: "Dayton",
              state: "OH",
              postal: "45402",
              country: "US",
              type: "LEGAL",
            },
            point: {
              type: "Point",
              coordinates: [
                -84.201279,

                39.771867,
              ],
            },
            polygon: "qntqFxd{`ONxAsB^KmAb@IAKlAU",
            phones: [
              {
                type: "Lot",
                number: "(937) 225-4572",
              },
              {
                type: "Central Office",
                number: "(937) 461-2916",
              },
            ],
            calculatedRates: null,
            isOpen: null,
            tz: "EDT",
          },
        ],
      };

      return turfPolys;
    }

    // Creating Polygon latyer using the information from INRIX Drive Time Polygons API and adding it to the map.
    async function drawLots() {
      document.getElementById("loading-panel").style.display = "block";

      // Access token management would be handled on the backend of your server, it would get / renew / reuse the token as necessary
      // this.accessToken = await getToken();
      // Getting the Lots as arrays of coordinates
      var data = await getLotsData();

      data.result.forEach((element) => {
        let coords = element.point.coordinates;

        var marker = L.marker([coords[1], coords[0]])
          .bindPopup(
            `Name: ${element.name} <br>
            Address: ${element.navigationAddress.street} <br>
            Phone: ${element.phone} <br>
            Payment Types: ${element.pmtTypes} <br>
            Hours: ${element.hrs} <br>
            Rate Card: ${element.rateCard} <br>
            `
          )
          .addTo(map)
          .on("click", function (e) {
            this.openPopup();
          });
        // console.log("placing marker");
      });
      document.getElementById("loading-panel").style.display = "none";
    }
  </script>
</html>
